<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Load-Bearing Nodes ¬∑ Semfora Explorer</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0d1117; color: #e6edf3; }
  header { padding: 16px 32px; border-bottom: 1px solid #21262d; display: flex; align-items: center; gap: 16px; }
  .logo { font-size: 20px; font-weight: 700; color: #58a6ff; text-decoration: none; }
  .logo span { color: #e6edf3; }
  .breadcrumb { color: #8b949e; font-size: 14px; }
  .main { display: grid; grid-template-columns: 240px 1fr; min-height: calc(100vh - 57px); }
  nav { border-right: 1px solid #21262d; padding: 16px 0; }
  nav a { display: flex; align-items: center; gap: 10px; padding: 8px 20px; color: #8b949e; text-decoration: none; font-size: 14px; border-left: 2px solid transparent; }
  nav a:hover { color: #e6edf3; background: #161b22; }
  nav a.active { color: #58a6ff; border-left-color: #58a6ff; background: #161b22; }
  nav .section-label { padding: 16px 20px 6px; font-size: 11px; font-weight: 600; color: #484f58; text-transform: uppercase; letter-spacing: 0.08em; }
  .content { padding: 24px 32px; }
  h1 { font-size: 22px; font-weight: 600; margin-bottom: 4px; }
  .subtitle { color: #8b949e; font-size: 13px; margin-bottom: 24px; }

  .explainer { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 16px 20px; margin-bottom: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .explain-col h3 { font-size: 13px; font-weight: 600; margin-bottom: 8px; }
  .explain-col p { font-size: 13px; color: #8b949e; line-height: 1.6; }
  .explain-good { border-left: 3px solid #3fb950; padding-left: 12px; }
  .explain-bad { border-left: 3px solid #f85149; padding-left: 12px; }

  .layout { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
  
  /* Graph area */
  .graph-area { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 20px; }
  .graph-area h3 { font-size: 13px; font-weight: 600; margin-bottom: 16px; color: #8b949e; }
  .graph-legend { display: flex; gap: 16px; flex-wrap: wrap; font-size: 12px; margin-bottom: 16px; }
  .gl-item { display: flex; align-items: center; gap: 6px; color: #8b949e; }
  .gl-swatch { width: 12px; height: 12px; border-radius: 50%; }
  .gl-pillar { width: 12px; height: 12px; border-radius: 2px; border: 2px solid #a371f7; background: #2d1f4e; }

  /* Node type indicators */
  .node-lb { background: #2d1f4e; border: 2px solid #a371f7; }        /* load-bearing (declared) */
  .node-unexpected { background: #3d1f1f; border: 2px solid #f85149; } /* unexpected load-bearing */
  .node-feature { background: #1c2128; border: 2px solid #30363d; }   /* normal feature code */
  .node-candidate { background: #3d2c1e; border: 2px dashed #e3b341; } /* candidate for LB declaration */

  svg text { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }

  /* Side panel */
  .side { display: flex; flex-direction: column; gap: 14px; }
  .panel-card { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 16px; }
  .panel-card h3 { font-size: 13px; font-weight: 600; margin-bottom: 12px; }

  .lb-item { padding: 10px 0; border-bottom: 1px solid #21262d; font-size: 12px; }
  .lb-item:last-child { border-bottom: none; padding-bottom: 0; }
  .lb-name { font-family: monospace; margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
  .lb-tag { font-size: 10px; padding: 1px 6px; border-radius: 4px; }
  .tag-declared { background: #2d1f4e; color: #a371f7; }
  .tag-auto { background: #21262d; color: #8b949e; }
  .lb-meta { color: #484f58; }

  .unexpected-item { background: #3d1f1f; border: 1px solid #f8514944; border-radius: 6px; padding: 10px 12px; font-size: 12px; margin-bottom: 8px; }
  .unexpected-item:last-child { margin-bottom: 0; }
  .ux-name { font-family: monospace; color: #f85149; margin-bottom: 4px; font-weight: 600; }
  .ux-detail { color: #8b949e; line-height: 1.5; }

  /* Stats row */
  .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
  .stat { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 14px 16px; }
  .stat-val { font-size: 26px; font-weight: 700; }
  .stat-lbl { font-size: 12px; color: #8b949e; margin-top: 2px; }

  /* Coupling audit table */
  .audit-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 16px; }
  .audit-table th { padding: 8px 12px; background: #1c2128; border-bottom: 1px solid #21262d; color: #8b949e; text-align: left; font-weight: 500; }
  .audit-table td { padding: 8px 12px; border-bottom: 1px solid #21262d; }
  .audit-table tr:last-child td { border-bottom: none; }
  .audit-table tr:hover td { background: #1c2128; }
  code { background: #21262d; padding: 1px 5px; border-radius: 3px; font-family: monospace; }
  
  .coupling-type { font-size: 11px; padding: 2px 7px; border-radius: 12px; font-weight: 600; white-space: nowrap; }
  .ct-expected { background: #1a3628; color: #3fb950; }
  .ct-unexpected { background: #3d1f1f; color: #f85149; }
</style>
</head>
<body>

<header>
  <a class="logo" href="index.html">semfora<span>explorer</span></a>
  <div class="breadcrumb">/ Load-Bearing Nodes</div>
</header>

<div class="main">
  <nav>
    <div class="section-label">Overview</div>
    <a href="index.html">üìä Dashboard</a>
    <div class="section-label">Analysis Tools</div>
    <a href="call-graph-diff.html">üîÄ Call Graph Diff</a>
    <a href="blast-radius.html">üí• Blast Radius</a>
    <a href="module-coupling.html">üß© Module Coupling</a>
    <a href="dead-code.html">ü™¶ Dead Code</a>
    <a href="legacy-planner.html">üèóÔ∏è Migration Planner</a>
    <a href="feature-risk.html">‚ö†Ô∏è Feature Risk</a>
    <a href="load-bearing-nodes.html" class="active">üèõÔ∏è Load-Bearing Nodes</a>
  </nav>

  <div class="content">
    <h1>üèõÔ∏è Load-Bearing Nodes</h1>
    <p class="subtitle">Distinguish expected infrastructure coupling from unexpected business-logic coupling. Not all high-centrality nodes are problems.</p>

    <div class="explainer">
      <div class="explain-col explain-good">
        <h3 style="color:#3fb950;">‚úì Load-Bearing Nodes (expected)</h3>
        <p>Deliberately shared infrastructure: HTTP gateways, job queues, database clients, logging, auth middleware. Everything funnels through these by design. High centrality here is healthy ‚Äî it means shared concerns are centralized, not duplicated.</p>
      </div>
      <div class="explain-col explain-bad">
        <h3 style="color:#f85149;">‚ö† Unexpected Coupling (the real problem)</h3>
        <p>Business logic, feature code, or utility functions that have quietly become load-bearing without being designed for it. Unknown tight coupling. These fail in non-obvious ways, resist change, and nobody knows they're there.</p>
      </div>
    </div>

    <div class="stats-row">
      <div class="stat">
        <div class="stat-val" style="color:#a371f7">12</div>
        <div class="stat-lbl">Declared load-bearing nodes</div>
      </div>
      <div class="stat">
        <div class="stat-val" style="color:#f85149">4</div>
        <div class="stat-lbl">Unexpected load-bearing detected</div>
      </div>
      <div class="stat">
        <div class="stat-val" style="color:#e3b341">7</div>
        <div class="stat-lbl">Candidates to declare</div>
      </div>
      <div class="stat">
        <div class="stat-val" style="color:#3fb950">68%</div>
        <div class="stat-lbl">Coupling through LB nodes (healthy)</div>
      </div>
    </div>

    <div class="layout">
      <!-- Graph -->
      <div class="graph-area">
        <h3>Call Graph ‚Äî Load-Bearing Node Overlay</h3>
        <div class="graph-legend">
          <div class="gl-item"><div class="gl-pillar"></div> Declared load-bearing</div>
          <div class="gl-item"><div class="gl-swatch" style="background:#f85149;"></div> Unexpected load-bearing</div>
          <div class="gl-item"><div class="gl-swatch" style="background:#e3b341;border-radius:2px;"></div> Candidate ‚Äî consider declaring</div>
          <div class="gl-item"><div class="gl-swatch" style="background:#30363d;"></div> Normal feature code</div>
        </div>

        <svg viewBox="0 0 620 420" width="100%" style="max-height:420px;">
          <defs>
            <marker id="arr" markerWidth="5" markerHeight="5" refX="5" refY="2.5" orient="auto">
              <path d="M0,0 L5,2.5 L0,5 Z" fill="#30363d"/>
            </marker>
            <marker id="arr-lb" markerWidth="5" markerHeight="5" refX="5" refY="2.5" orient="auto">
              <path d="M0,0 L5,2.5 L0,5 Z" fill="#a371f744"/>
            </marker>
            <marker id="arr-bad" markerWidth="5" markerHeight="5" refX="5" refY="2.5" orient="auto">
              <path d="M0,0 L5,2.5 L0,5 Z" fill="#f85149"/>
            </marker>
          </defs>

          <!-- Load-bearing nodes (purple pillars) -->
          <!-- HTTP Gateway -->
          <rect x="250" y="15" width="120" height="40" rx="6" fill="#2d1f4e" stroke="#a371f7" stroke-width="2"/>
          <text x="310" y="31" text-anchor="middle" fill="#a371f7" font-size="11" font-weight="600">HTTPGateway</text>
          <text x="310" y="46" text-anchor="middle" fill="#a371f766" font-size="9">üèõ load-bearing</text>

          <!-- JobQueue -->
          <rect x="460" y="155" width="100" height="40" rx="6" fill="#2d1f4e" stroke="#a371f7" stroke-width="2"/>
          <text x="510" y="171" text-anchor="middle" fill="#a371f7" font-size="11" font-weight="600">JobQueue</text>
          <text x="510" y="186" text-anchor="middle" fill="#a371f766" font-size="9">üèõ load-bearing</text>

          <!-- DB Client -->
          <rect x="240" y="330" width="140" height="40" rx="6" fill="#2d1f4e" stroke="#a371f7" stroke-width="2"/>
          <text x="310" y="346" text-anchor="middle" fill="#a371f7" font-size="11" font-weight="600">DatabaseClient</text>
          <text x="310" y="361" text-anchor="middle" fill="#a371f766" font-size="9">üèõ load-bearing</text>

          <!-- Logger -->
          <rect x="30" y="155" width="90" height="40" rx="6" fill="#2d1f4e" stroke="#a371f7" stroke-width="2"/>
          <text x="75" y="171" text-anchor="middle" fill="#a371f7" font-size="11" font-weight="600">Logger</text>
          <text x="75" y="186" text-anchor="middle" fill="#a371f766" font-size="9">üèõ load-bearing</text>

          <!-- Feature nodes (normal) -->
          <rect x="50" y="75" width="100" height="34" rx="5" fill="#1c2128" stroke="#30363d" stroke-width="1.5"/>
          <text x="100" y="96" text-anchor="middle" fill="#8b949e" font-size="11">AuthController</text>

          <rect x="430" y="75" width="110" height="34" rx="5" fill="#1c2128" stroke="#30363d" stroke-width="1.5"/>
          <text x="485" y="96" text-anchor="middle" fill="#8b949e" font-size="11">CheckoutHandler</text>

          <rect x="80" y="240" width="110" height="34" rx="5" fill="#1c2128" stroke="#30363d" stroke-width="1.5"/>
          <text x="135" y="261" text-anchor="middle" fill="#8b949e" font-size="11">UserRepository</text>

          <rect x="400" y="240" width="120" height="34" rx="5" fill="#1c2128" stroke="#30363d" stroke-width="1.5"/>
          <text x="460" y="261" text-anchor="middle" fill="#8b949e" font-size="11">OrderRepository</text>

          <!-- UNEXPECTED load-bearing node -->
          <rect x="215" y="155" width="130" height="40" rx="5" fill="#3d1f1f" stroke="#f85149" stroke-width="2"/>
          <text x="280" y="171" text-anchor="middle" fill="#f85149" font-size="11" font-weight="600">formatCurrency()</text>
          <text x="280" y="186" text-anchor="middle" fill="#f8514966" font-size="9">‚ö† unexpected LB ‚Äî utils/</text>

          <!-- Candidate -->
          <rect x="50" y="330" width="110" height="34" rx="5" fill="#3d2c1e" stroke="#e3b341" stroke-width="1.5" stroke-dasharray="4,3"/>
          <text x="105" y="351" text-anchor="middle" fill="#e3b341" font-size="11">AuditLogger</text>

          <!-- Edges ‚Äî expected (through LB) -->
          <line x1="150" y1="92" x2="250" y2="34" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          <line x1="485" y1="109" x2="440" y2="155" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          <line x1="310" y1="55" x2="310" y2="155" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          <line x1="100" y1="109" x2="75" y2="155" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          <line x1="135" y1="274" x2="240" y2="338" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          <line x1="460" y1="274" x2="380" y2="338" stroke="#a371f733" stroke-width="1.5" marker-end="url(#arr-lb)"/>
          
          <!-- Edges ‚Äî feature to feature (normal) -->
          <line x1="100" y1="109" x2="120" y2="240" stroke="#30363d" stroke-width="1.5" marker-end="url(#arr)"/>
          <line x1="485" y1="109" x2="460" y2="240" stroke="#30363d" stroke-width="1.5" marker-end="url(#arr)"/>

          <!-- Edges ‚Äî UNEXPECTED (through formatCurrency) -->
          <!-- multiple features calling it from different domains -->
          <line x1="150" y1="100" x2="220" y2="165" stroke="#f85149" stroke-width="2" opacity="0.7" marker-end="url(#arr-bad)"/>
          <line x1="435" y1="100" x2="345" y2="165" stroke="#f85149" stroke-width="2" opacity="0.7" marker-end="url(#arr-bad)"/>
          <line x1="190" y1="257" x2="235" y2="185" stroke="#f85149" stroke-width="2" opacity="0.7" marker-end="url(#arr-bad)"/>
          <line x1="410" y1="257" x2="340" y2="185" stroke="#f85149" stroke-width="2" opacity="0.7" marker-end="url(#arr-bad)"/>

          <!-- Label for unexpected coupling area -->
          <rect x="160" y="210" width="240" height="20" rx="3" fill="#3d1f1f" opacity="0.6"/>
          <text x="280" y="223" text-anchor="middle" fill="#f85149" font-size="10">4 modules ‚Üí formatCurrency() ‚Üê unexpected!</text>
        </svg>
      </div>

      <!-- Side panel -->
      <div class="side">
        <div class="panel-card">
          <h3 style="color:#a371f7;">üèõ Declared Load-Bearing Nodes</h3>
          <div class="lb-item">
            <div class="lb-name">HTTPGateway <span class="lb-tag tag-declared">declared</span></div>
            <div class="lb-meta">core/ ¬∑ 54 callers ¬∑ expected</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">DatabaseClient <span class="lb-tag tag-declared">declared</span></div>
            <div class="lb-meta">core/ ¬∑ 47 callers ¬∑ expected</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">JobQueue <span class="lb-tag tag-declared">declared</span></div>
            <div class="lb-meta">platform/ ¬∑ 31 callers ¬∑ expected</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">Logger <span class="lb-tag tag-declared">declared</span></div>
            <div class="lb-meta">platform/ ¬∑ 89 callers ¬∑ expected</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">AuthMiddleware <span class="lb-tag tag-declared">declared</span></div>
            <div class="lb-meta">core/ ¬∑ 18 callers ¬∑ expected</div>
          </div>
          <div style="padding-top:10px;">
            <button style="background:transparent;border:1px dashed #a371f744;color:#a371f7;font-size:12px;padding:5px 12px;border-radius:6px;cursor:pointer;width:100%;">+ Declare a load-bearing node</button>
          </div>
        </div>

        <div class="panel-card" style="border-color:#f8514944;">
          <h3 style="color:#f85149;">‚ö† Unexpected Load-Bearing</h3>
          <div class="unexpected-item">
            <div class="ux-name">utils/currency.ts ‚Üí formatCurrency()</div>
            <div class="ux-detail">Centrality: 0.71 ¬∑ 4 feature domains depend on it. Not designed as shared infrastructure. If this changes, checkout, orders, discounts, and reports all break.</div>
          </div>
          <div class="unexpected-item">
            <div class="ux-name">users/helpers.ts ‚Üí resolveUserContext()</div>
            <div class="ux-detail">Centrality: 0.58 ¬∑ Grew from a single-purpose helper into a dependency of 6 unrelated modules.</div>
          </div>
        </div>

        <div class="panel-card">
          <h3 style="color:#e3b341;">Candidates to Declare</h3>
          <p style="font-size:12px;color:#8b949e;margin-bottom:10px;">High centrality, stable, looks intentional ‚Äî but not yet declared.</p>
          <div class="lb-item">
            <div class="lb-name">EventBus <span class="lb-tag tag-auto">auto-detected</span></div>
            <div class="lb-meta">core/ ¬∑ 22 callers</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">CacheClient <span class="lb-tag tag-auto">auto-detected</span></div>
            <div class="lb-meta">platform/ ¬∑ 18 callers</div>
          </div>
          <div class="lb-item">
            <div class="lb-name">AuditLogger <span class="lb-tag tag-auto">auto-detected</span></div>
            <div class="lb-meta">core/ ¬∑ 14 callers</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coupling audit table -->
    <div style="margin-top:24px;">
      <h2 style="font-size:15px;font-weight:600;margin-bottom:6px;">Coupling Surface Audit</h2>
      <p style="font-size:13px;color:#8b949e;margin-bottom:0;">For each cross-domain call edge, classify the coupling type.</p>
      <table class="audit-table">
        <thead>
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Shared node</th>
            <th>Type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>checkout/</td>
            <td>auth/</td>
            <td><code>AuthMiddleware</code></td>
            <td><span class="coupling-type ct-expected">‚úì Expected ‚Äî LB node</span></td>
            <td style="color:#484f58;font-size:11px;">No action needed</td>
          </tr>
          <tr>
            <td>checkout/</td>
            <td>orders/</td>
            <td><code>OrderRepository.save()</code></td>
            <td><span class="coupling-type ct-unexpected">‚ö† Unexpected business logic</span></td>
            <td style="color:#58a6ff;font-size:11px;">Consider event-based decoupling</td>
          </tr>
          <tr>
            <td>orders/</td>
            <td>notifications/</td>
            <td><code>resolveUserContext()</code></td>
            <td><span class="coupling-type ct-unexpected">‚ö† Unexpected ‚Äî via utility</span></td>
            <td style="color:#58a6ff;font-size:11px;">Extract interface or declare LB</td>
          </tr>
          <tr>
            <td>discounts/</td>
            <td>checkout/</td>
            <td><code>formatCurrency()</code></td>
            <td><span class="coupling-type ct-unexpected">‚ö† Unexpected ‚Äî utils leakage</span></td>
            <td style="color:#58a6ff;font-size:11px;">Declare formatCurrency() as LB or move to core/</td>
          </tr>
          <tr>
            <td>payments/</td>
            <td>platform/</td>
            <td><code>JobQueue</code></td>
            <td><span class="coupling-type ct-expected">‚úì Expected ‚Äî LB node</span></td>
            <td style="color:#484f58;font-size:11px;">No action needed</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</body>
</html>
